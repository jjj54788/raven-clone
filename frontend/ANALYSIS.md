# Frontend Notes (Next.js App Router)

Last updated: 2026-02-15

## Structure / Entry Points

- App Router pages live in `frontend/src/app/`
  - Main chat: `frontend/src/app/page.tsx` (client component)
  - Login/register: `frontend/src/app/login/page.tsx` (client component)
  - Coming soon: `frontend/src/app/coming-soon/page.tsx`
  - Layout: `frontend/src/app/layout.tsx` (wraps `LanguageProvider`)
  - Global styles: `frontend/src/app/globals.css` (Tailwind v4 + CSS variables)

## API / Auth

- API wrapper: `frontend/src/lib/api.ts`
  - Uses `Authorization: Bearer <token>` header.
  - Stores `accessToken` in `localStorage` under `raven_token`.
  - Stores user object in `localStorage` under `raven_user`.
- Client-side auth gate:
  - `useAuth()` (`frontend/src/hooks/useAuth.ts`) redirects to `/login` if no token.

## Chat UI Summary

- `frontend/src/app/page.tsx` orchestrates:
  - Model list via `useModels()`
  - Sessions/messages via `useSessions()`
  - Streaming chat via `sendStreamChat()` (SSE parsing in fetch stream)
  - Auto-create session when sending the first message of a new chat
- Rendering:
  - `ChatHistory`, `ChatArea`, `ChatInput`, `ChatMessage`, `Sidebar`, etc. in `frontend/src/components/`
- i18n:
  - `LanguageContext` with `en.json`/`zh.json`, persisted in `localStorage` (`raven_lang`)

## Known Issues / Risks

- API base is hard-coded to `http://localhost:3001/api/v1` (`frontend/src/lib/api.ts`), so deployments need code changes unless refactored to env-driven base URL.
- Token stored in `localStorage` (XSS blast radius). If switching to cookies, add CSRF protections.
- Auth is purely client-side routing (no SSR protection/middleware).

<!-- AUTO-GENERATED:BEGIN -->
## Auto-Generated Snapshot

This section is generated by `scripts/gen-analysis-md.mjs`. Manual edits inside this block will be overwritten.

### Scope
- Directory: `frontend`

### Detected Pages (Next.js App Router)
- `/` (frontend/src/app/page.tsx)
- `/coming-soon` (frontend/src/app/coming-soon/page.tsx)
- `/login` (frontend/src/app/login/page.tsx)
- `/notifications` (frontend/src/app/notifications/page.tsx)
- `/whats-new` (frontend/src/app/whats-new/page.tsx)

### File Tree (depth <= 3)
```text
ANALYSIS.md
next-env.d.ts
next.config.js
package.json
pnpm-lock.yaml
postcss.config.js
src/
src/app/
src/app/ANALYSIS.md
src/app/coming-soon/
src/app/coming-soon/page.tsx
src/app/globals.css
src/app/layout.tsx
src/app/login/
src/app/login/page.tsx
src/app/not-found.tsx
src/app/notifications/
src/app/notifications/page.tsx
src/app/page.tsx
src/app/whats-new/
src/app/whats-new/page.tsx
src/components/
src/components/ANALYSIS.md
src/components/ChatArea.tsx
src/components/ChatHistory.tsx
src/components/ChatInput.tsx
src/components/ChatMessage.tsx
src/components/DailyCheckInReminder.tsx
src/components/QuoteFooter.tsx
src/components/Sidebar.tsx
src/components/WelcomeScreen.tsx
src/hooks/
src/hooks/ANALYSIS.md
src/hooks/index.ts
src/hooks/useAuth.ts
src/hooks/useModels.ts
src/hooks/useSessions.ts
src/i18n/
src/i18n/ANALYSIS.md
src/i18n/en.json
src/i18n/LanguageContext.tsx
src/i18n/zh.json
src/lib/
src/lib/ANALYSIS.md
src/lib/api.ts
src/lib/changelog.ts
src/lib/firebase.ts
src/lib/notifications.ts
src/lib/version.ts
tsconfig.json
```
<!-- AUTO-GENERATED:END -->
